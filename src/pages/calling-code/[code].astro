---
import Layout from '../../components/Layout.astro';
import countries from '../../data/countries.generated.json';

const code = Astro.params.code ?? '';

const codeDigits = String(code).replace(/[^0-9]/g, '');

export function getStaticPaths() {
  const codes = Array.from(new Set(countries.map((c) => c.callingCode)));
  return codes.map((cc) => ({ params: { code: cc } }));
}

const matches = countries.filter((c) => c.callingCode === codeDigits);
if (!matches.length) {
  throw new Error(`Unknown calling code: ${codeDigits}`);
}

const title = `Country calling code +${codeDigits} — countries, regions, and how to dial`;
const description = `Which country uses calling code +${codeDigits}? See all countries/territories that share +${codeDigits}, plus dialling notes, examples, and links to country-specific instructions.`;

const isShared = matches.length > 1;

const faqs = [
  {
    q: `Which country code is +${codeDigits}?`,
    a: isShared
      ? `Calling code +${codeDigits} is shared by multiple countries/territories. See the list below and click through for exact dialling instructions.`
      : `Calling code +${codeDigits} is used by ${matches[0].name}.`,
  },
  {
    q: `How do I dial an international number with +${codeDigits}?`,
    a: `On mobiles you can usually dial “+${codeDigits}” followed by the national number. On landlines you may need to dial your country’s exit code first, then ${codeDigits}, then the national number (often with any domestic trunk prefix removed).`,
  },
  {
    q: `Why can +${codeDigits} be ambiguous?`,
    a: `Some calling codes are shared (for example, +1 is used across the North American Numbering Plan). If a calling code is shared, you need additional digits (area code/number ranges) to identify the exact destination.`,
  },
];

const faqJsonLd = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faqs.map((f) => ({
    '@type': 'Question',
    name: f.q,
    acceptedAnswer: { '@type': 'Answer', text: f.a },
  })),
};
---

<Layout title={title} description={description}>
  <h1 style="margin: 22px 0 6px;">Calling code <span class="kbd">+{codeDigits}</span></h1>
  <p class="small">
    <span class="kbd">+{codeDigits}</span> is a <strong>country calling code</strong> used in international phone numbers.
    {isShared ? ' This calling code is shared by multiple destinations.' : ' This calling code maps to a single destination.'}
  </p>

  <div class="card" style="margin-top: 14px;">
    <h2 style="margin-top:0">Countries and territories using +{codeDigits}</h2>
    <ul>
      {matches.map((c) => (
        <li>
          <a href={`/country/${c.iso2.toLowerCase()}/`}>{c.name}</a>
          <span class="small"> ({c.iso2})</span>
        </li>
      ))}
    </ul>

    <p class="small" style="margin-top: 14px;">
      Tip: if you already know the destination country, the <a href={`/dial-builder/?to=${matches[0].iso2}`}>Dial Builder</a> can generate an exact dial string.
    </p>
  </div>

  <div class="card" style="margin-top: 16px;">
    <h2 style="margin-top:0">FAQ</h2>
    {faqs.map((f) => (
      <details style="margin: 10px 0;">
        <summary><strong>{f.q}</strong></summary>
        <p class="small">{f.a}</p>
      </details>
    ))}
  </div>

  <script type="application/ld+json" set:html={JSON.stringify(faqJsonLd)} />
</Layout>
